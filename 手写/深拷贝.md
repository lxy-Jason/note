```js
function clone(target, map = new WeakMap()) {
    //基本类型直接返回
  if (typeof target !== "object" || target === null) return target;

  const isArray = Array.isArray(target); //判断是不是数组
  let cloneTarget = isArray ? [] : {}; //新建对象

  if (map.get(target)) {
    //如果之前已经拷贝过了就直接返回,这里是避免循环引用导致栈溢出
    return map.get(target);
  }
  map.set(target, cloneTarget);
  for (const key in target) {
    //遍历拷贝
    cloneTarget[key] = clone(target[key], map);
  }
  return cloneTarget;
}
const target = {
  field1: 1,
  field2: undefined,
  field3: {
    child: "child",
  },
  field4: [2, 4, 8],
  field5: null,
};
target.target = target;
newObj = clone(target);
console.log(newObj.field4 === target.field4);

```

