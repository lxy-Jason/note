## webpack

### webpack的优点

- 丰富的生态,各种各样的插件
- 首屏加载,懒加载 
  - 由于dev启动过程中已经完成了整个打包操作,直接将构建好的首屏内容发送给浏览器,不存在性能问题
  - 也是因为进行了打包操作,所有的依赖在dev构建过程中得以处理,懒加载也不存在问题

### webpack的缺点

- 本地启动时间长,
  - 在构建过程中涉及大量的文件IO,源文件转换等操作
  - 在分析依赖图的时候还需要进行遍历操作,文件操作
- 热更新反应速度比较慢
  - 

## vite

vite的原理是借助了浏览器对ESM的规范的支持

vite将模块分为依赖和源码两类,改进了开发服务器的启动时间

依赖是开发时不会变动的纯js文件

vite将会使用esbuild预构建依赖,esbuild用go编写,速度更快

源码是需要被转换的文件,例如jsx,css,vue等文件

**vite以原生ESM方式提供源码,让浏览器接管打包程序的部分工作**

**vite只需要在浏览器请求源码的时候进行转换并且按需提供源码**

### 优点

- 项目启动快
  - 只是启动了一台静态页面的服务器,没有对文件代码进行打包
  - 源文件之间的依赖关系通过浏览器对ESM规范的支持来解析
- 热更新快
  - 本地开发环境,在监听到文件变化后,直接通过ws连接,通知浏览器去重新加载变动的文件
  - HMR是在原生ESM上执行
  - 编辑一个文件时,vite只需要精确地让已编辑的模块与其最近的HMR边界之间的链失活(大多数时候只是模块本身)
  - 源码模块的请求会根据304进行协商缓存
  - 依赖模块缓存:解析后的依赖请求会通过Cache-Control:max-age=3153600,immutable进行强缓存,缓存之后就不需要再次请求

### 缺点

- 首屏加载慢,懒加载慢
  - 没有对文件进行bundle操作,会导致大量的http请求
  - dev服务运行期间会对源文件做转换操作,需要时间
  - VIte需要把webpack dev启动完成的工作,移接到dev响应浏览器的过程中,时间加长

### vite生产环境

- 生产环境需要打包,打包之后能获得更好的加载性能

## 构建理念不同

- Vite : 依赖预构建,开发期间启动一个服务器,index.html作为入口文件
- webpack: 会在内部构建依赖图,index.js作为构建入口,进入入口后,webpack找出有哪些模块和库是入口起点的依赖

### VIte

- 非打包构建,不必打包所有内容
- 基于路由的代码拆分,知道实际需要加载哪些代码,浏览器请求源文件时,再进行转换
- 依赖是第三方库的,使用esbuild的处理
- 浏览器中的原生支持,浏览器在开发中承担打包工作

### webpack

- 识别入口文件
- 逐级递归识别依赖,构建依赖图
- 分析代码,转换代码,编译代码,输出代码
- 输出打包后的代码

